<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life & Gallery - Runde Yang</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    
    <style>
        /* --- 1. 核心變量 (與 index.html 完全一致) --- */
        :root {
            --bg-color: #fcfbf9;
            --text-color: #333333;
            --accent-color: #2c5282;
            --accent-hover-bg: rgba(44, 82, 130, 0.08);
            --header-height: 64px;
            --caption-color: #555555;

            /* 字體系統 */
            --font-default: "Calibri", "BiaoKaiTi", "DFKai-SB", "AR PL UKai CN", "KaiTi", serif;
            --font-zh-cn: "Calibri", "BiaoKaiTi", "DFKai-SB", "AR PL UKai CN", "KaiTi", "STKaiti", serif;
            --font-zh-tw: "Calibri", "BiaoKaiTi", "DFKai-SB", serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.8;
            font-family: var(--font-default);
            padding-top: var(--header-height); /* 為固定導航欄留出空間 */
        }

        /* --- 2. 頂部導航欄 (從 index.html 移植) --- */
        .fixed-header {
            position: fixed;
            top: 0; left: 0; width: 100%; height: var(--header-height);
            background-color: rgba(252, 251, 249, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            z-index: 1000;
            display: flex; justify-content: center;
        }
        .header-inner {
            width: 100%; max-width: 1150px; padding: 0 20px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .header-left { display: flex; align-items: center; gap: 10px; }
        .header-name-link {
            font-weight: bold; font-size: 1.2rem; color: #000;
            text-decoration: none; margin-right: 20px; font-family: "Calibri", sans-serif;
        }
        .nav-link {
            color: #555; text-decoration: none; font-size: 0.95rem;
            padding: 8px 16px; border-radius: 6px; transition: all 0.2s ease; font-weight: 500;
        }
        .nav-link:hover { background-color: var(--accent-hover-bg); color: var(--accent-color); }
        .header-right { display: flex; align-items: center; }
        
        /* 語言按鈕 */
        .lang-btn {
            background: none; border: none; cursor: pointer; color: #999;
            padding: 4px 8px; border-radius: 4px; font-family: "Calibri", sans-serif;
            font-size: 0.9rem; transition: all 0.2s;
        }
        .lang-btn:hover { background-color: #eee; color: #333; }
        .lang-btn.active { color: var(--accent-color); font-weight: bold; }

        /* --- 3. 頁面容器 --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0px 20px;
        }

        /* --- 4. Life 頁面特定樣式 --- */
        h2 {
            font-size: 1.5rem; color: var(--accent-color);
            border-bottom: 2px solid #eee; padding-bottom: 10px;
            margin-top: 60px; margin-bottom: 20px;
        }

        /* Gallery */
/* --- Gallery: 疊放照片堆 (Polaroid Stack) --- */
/* --- Gallery: 可拖拽的正方形堆疊相冊 --- */
        
        /* 1. 最外層容器：負責遮罩 (虛化邊緣) 和隱藏滾動條 */
        .gallery-scroll-view {
            position: relative;
            width: 100%;
            overflow: hidden; /* 隱藏默認滾動條，改用 JS 拖拽 */
            padding: 40px 0; /* 上下留白給懸浮動畫 */
            cursor: grab;    /* 鼠標手勢：抓取 */
            
            /* 核心：左右邊緣漸變虛化 (CSS Mask) */
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 10%, black 90%, transparent 100%);
            mask-image: linear-gradient(to right, transparent 0%, black 10%, black 90%, transparent 100%);
        }
        
        .gallery-scroll-view:active {
            cursor: grabbing; /* 抓取時的手勢 */
        }

        /* 2. 內部軌道：負責橫向排列 */
        .gallery-track {
            display: flex;
            align-items: center;
            width: max-content; /* 寬度根據內容自動延伸 */
            padding: 0 50px;    /* 兩側留白，保證第一張和最後一張能被看到 */
            padding-left: 100px; /* 初始位置稍微靠右一點 */
        }

        /* 3. 卡片本體 */
        .photo-card {
            position: relative;
            width: 240px;
            height: 240px; /* 正方形 */
            background: #fff;
            border: 4px solid #fff;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1); /* 陰影在左側 */
            border-radius: 4px; /* 輕微圓角 */
            overflow: hidden;
            
            /* 核心：負邊距實現重疊 (後一張壓住前一張的一半) */
            margin-left: -120px; 
            
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            user-select: none; /* 防止拖拽時選中圖片 */
        }

        /* 第一張不要負邊距 */
        .photo-card:first-child {
            margin-left: 0;
        }

        .photo-card img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 填滿正方形 */
            pointer-events: none; /* 防止圖片本身的拖拽干擾 JS 邏輯 */
        }

        /* 4. 註釋文字 (默認隱藏) */
        .photo-caption {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            background: rgba(255,255,255,0.95);
            padding: 10px;
            text-align: center;
            font-size: 0.9rem;
            color: #333;
            transform: translateY(100%); /* 默認沉在下面 */
            transition: transform 0.3s;
        }

        /* 5. 懸浮互動 (抽出來) */
        .photo-card:hover {
            transform: translateY(-40px) scale(1.1); /* 向上浮起 + 放大 */
            z-index: 100; /* 層級最高 */
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            margin-right: 60px; /* 稍微推開右邊的圖片，讓自己完全露出來 */
        }

        .photo-card:hover .photo-caption {
            transform: translateY(0); /* 文字浮現 */
        }

        /* Map */
        .map-container { display: flex; flex-wrap: wrap; gap: 20px; }
        .map-box { flex: 1; min-width: 300px; height: 400px; background: #fff; border: 1px solid #eee; }

        /* Shelf (List) */
        .item-list { display: flex; flex-direction: column; gap: 20px; }
        .item-card { display: flex; gap: 20px; align-items: flex-start; }
        .item-cover { width: 60px; height: 85px; background: #ddd; flex-shrink: 0; object-fit: cover; }
        .item-info h3 { margin: 0 0 5px 0; font-size: 1rem; }
        .item-comment { color: #555; font-size: 0.95rem; }

        /* Thoughts */
        .snippet-list { border-left: 2px solid #eee; padding-left: 20px; margin-left: 10px; }
        .snippet-item { margin-bottom: 30px; position: relative; }
        .snippet-item::before {
            content: ''; position: absolute; left: -26px; top: 6px;
            width: 10px; height: 10px; background: var(--accent-color); border-radius: 50%;
        }
        .snippet-date { font-size: 0.8rem; color: #999; margin-bottom: 5px; font-family: "Calibri", sans-serif; }
        .snippet-content { font-size: 1.05rem; }

        /* Friend Links */
        .friend-list { display: flex; flex-wrap: wrap; gap: 15px; }
        .friend-link {
            padding: 5px 15px; border: 1px solid #ddd; border-radius: 20px;
            color: #555; text-decoration: none; font-size: 0.9rem; transition: all 0.2s;
        }
        .friend-link:hover { border-color: var(--accent-color); color: var(--accent-color); }

        /* Lightbox */
        .lightbox {
            display: none; position: fixed; z-index: 2000; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); justify-content: center; align-items: center; flex-direction: column;
        }
        .lightbox img { max-width: 90%; max-height: 80vh; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .lightbox-caption { margin-top: 20px; text-align: center; font-size: 1.1rem; color: #333; }
        .lightbox-close { position: absolute; top: 20px; right: 30px; font-size: 3rem; cursor: pointer; color: #333; }

        /* 響應式 */
        @media (max-width: 850px) {
            .header-left .nav-link { display: none; } /* 手機端隱藏中間鏈接 */
            .header-inner { justify-content: space-between; }
        }
    </style>
</head>
<body>

<nav class="fixed-header">
    <div class="header-inner">
        <div class="header-left">
            <a href="index.html" class="header-name-link">Runde Yang</a>
            
            <a href="#gallery" class="nav-link" data-key="nav_gallery">Gallery</a>
            <a href="#map" class="nav-link" data-key="nav_map">Footprints</a>
            <a href="#shelf" class="nav-link" data-key="nav_shelf">Shelf</a>
            <a href="#thoughts" class="nav-link" data-key="nav_thoughts">Thoughts</a>
        </div>

        <div class="header-right">
            <button class="lang-btn active" onclick="setLang('en')">EN</button>
            <span style="color:#ddd; margin:0 3px;">|</span>
            <button class="lang-btn" onclick="setLang('zh-CN')">简</button>
            <span style="color:#ddd; margin:0 3px;">|</span>
            <button class="lang-btn" onclick="setLang('zh-TW')">繁</button>
        </div>
    </div>
</nav>

<div class="container">

    <section id="gallery">
        <h2 data-key="title_gallery">Gallery</h2>
        
        <div class="gallery-scroll-view" id="galleryContainer">
            <div class="gallery-track">
                
                <div class="photo-card" onclick="openLightbox(this)">
                    <img src="images/meteor.jpg" alt="Qiandao Lake"> 
                    <div class="photo-caption" data-key="cap_meteor">Qiandao Lake, 2024.</div>
                </div>

                <div class="photo-card" onclick="openLightbox(this)">
                    <img src="images/美哉吾校.jpg" alt="Campus">
                    <div class="photo-caption" data-key="cap_campus">SJTU Campus.</div>
                </div>

            </div>
        </div>
    </section>

    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <span class="lightbox-close">&times;</span>
        <img id="lightbox-img" src="">
        <div class="lightbox-caption" id="lightbox-caption"></div>
    </div>

    <section id="map">
        <h2 data-key="title_map">Footprints</h2>
        <div class="map-container">
            <div id="china-map" class="map-box"></div>
            <div id="world-map" class="map-box"></div>
        </div>
    </section>

    <section id="shelf">
        <h2 data-key="title_shelf">Shelf</h2>
        <div class="item-list">
            
            <div class="item-card">
                <img src="https://via.placeholder.com/60x85" class="item-cover">
                <div class="item-info">
                    <h3>Deep Learning (Ian Goodfellow)</h3>
                    <div class="item-comment" data-key="book_dl">Mathematical foundation is excellent. Not just a tool book, but a mind map.</div>
                </div>
            </div>

            <div class="item-card">
                <img src="https://via.placeholder.com/60x85" class="item-cover">
                <div class="item-info">
                    <h3>Interstellar</h3>
                    <div class="item-comment" data-key="movie_interstellar">Love is the one thing that transcends time and space.</div>
                </div>
            </div>

        </div>
    </section>

    <section id="thoughts">
        <h2 data-key="title_thoughts">Thoughts</h2>
        <div class="snippet-list">
            
            <div class="snippet-item">
                <div class="snippet-date">Dec 15, 2024</div>
                <div class="snippet-content" data-key="thought_1">
                    Realized that "subtraction" is harder than "addition". Code is like this, life is like this.
                </div>
            </div>

            <div class="snippet-item">
                <div class="snippet-date">Nov 10, 2024</div>
                <div class="snippet-content" data-key="thought_2">
                    Meteor shower at Qiandao Lake. The naked eye sees 10,000 times more than the camera.
                </div>
            </div>

        </div>
    </section>

    <section>
        <h2 data-key="title_friends">Friends</h2>
        <div class="friend-list">
            <a href="#" class="friend-link">Laboratory Partner A</a>
            <a href="#" class="friend-link">SJTU AI Club</a>
        </div>
    </section>

    <footer style="text-align: center; color: #999; font-size: 0.8rem; margin-top: 60px;">
        &copy; 2025 Runde Yang.
    </footer>

</div>

<script>
    // --- 1. 內容數據字典 (包含所有翻譯) ---
    const content = {
        en: {
            nav_gallery: "Gallery", nav_map: "Footprints", nav_shelf: "Shelf", nav_thoughts: "Thoughts",
            title_gallery: "Gallery", title_map: "Footprints", title_shelf: "Shelf", title_thoughts: "Thoughts", title_friends: "Friends",
            
            // 具體內容
            cap_meteor: "Qiandao Lake, 2025. Meteor shower.",
            cap_campus: "Shanghai, SJTU. Spring on campus.",
            book_dl: "Mathematical foundation is excellent. Not just a tool book, but a mind map.",
            movie_interstellar: "Love is the one thing that transcends time and space.",
            thought_1: "Realized that 'subtraction' is harder than 'addition'. Code is like this, life is like this.",
            thought_2: "Meteor shower at Qiandao Lake. The naked eye sees 10,000 times more than the camera.",
            
            // 圖表標題
            chart_china: "China Footprints", chart_world: "World Footprints"
        },
        'zh-CN': {
            nav_gallery: "光影", nav_map: "足迹", nav_shelf: "书影", nav_thoughts: "随笔",
            title_gallery: "光影 / Gallery", title_map: "足迹 / Footprints", title_shelf: "书影 / Shelf", title_thoughts: "随笔 / Snippets", title_friends: "友链 / Friends",
            
            cap_meteor: "2025 猎户座流星雨",
            cap_campus: "美哉吾校，真理之花<br>青年之楷模，邦国之荣华",
            book_dl: "常读常新。数学基础部分写得极好，不仅是工具书，更是思维导图。",
            movie_interstellar: "爱是唯一可以穿越时间与空间的事物。",
            thought_1: "整理这份主页的时候，突然意识到“减法”比“加法”难得多。代码如此，生活亦然。",
            thought_2: "千岛湖的流星雨。肉眼看到的比相机拍到的震撼一万倍。人类的镜头终究还是太局限了。",

            chart_china: "中国足迹", chart_world: "世界足迹"
        },
        'zh-TW': {
            nav_gallery: "光影", nav_map: "足跡", nav_shelf: "書影", nav_thoughts: "隨筆",
            title_gallery: "光影 / Gallery", title_map: "足跡 / Footprints", title_shelf: "書影 / Shelf", title_thoughts: "隨筆 / Snippets", title_friends: "友鏈 / Friends",
            
            cap_meteor: "2025 獵戶座流星雨",
            cap_campus: "美哉吾校，真理之花<br>青年之楷模，邦國之榮華",
            book_dl: "常讀常新。數學基礎部分寫得極好，不僅是工具書，更是思維導圖。",
            movie_interstellar: "愛是唯一可以穿越時間與空間的事物。",
            thought_1: "整理這份主頁的時候，突然意識到「減法」比「加法」難得多。代碼如此，生活亦然。",
            thought_2: "千島湖的流星雨。肉眼看到的比相機拍到的震撼一萬倍。人類的鏡頭終究還是太侷限了。",

            chart_china: "中國足跡", chart_world: "世界足跡"
        }
    };

    // --- 2. 語言切換邏輯 ---
    function setLang(lang) {
        // 更新按鈕
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.innerText.toLowerCase().includes(lang === 'en' ? 'en' : (lang === 'zh-CN' ? '简' : '繁'))) {
                btn.classList.add('active');
            }
        });

        // 更新文本內容
        const data = content[lang];
        document.querySelectorAll('[data-key]').forEach(el => {
            const key = el.getAttribute('data-key');
            if (data[key]) {
                el.innerHTML = data[key];
            }
        });

        // 更新字體變量 (與 Index 保持一致)
        const body = document.body;
        body.style.fontFamily = ''; 
        if (lang === 'zh-CN') body.style.fontFamily = 'var(--font-zh-cn)';
        else if (lang === 'zh-TW') body.style.fontFamily = 'var(--font-zh-tw)';
        else body.style.fontFamily = 'var(--font-default)';

        // 更新圖表標題
        updateChartTitles(data.chart_china, data.chart_world);
        syncEchartsFont();
    }

    // --- 3. Lightbox 邏輯 ---
    function openLightbox(element) {
        const imgSrc = element.querySelector('img').src;
        // 直接讀取當前顯示的文字 (因為 setLang 已經更新了 DOM)
        const captionText = element.querySelector('.photo-caption').innerText;

        document.getElementById('lightbox-img').src = imgSrc;
        document.getElementById('lightbox-caption').innerText = captionText;
        document.getElementById('lightbox').style.display = 'flex';
    }

    function closeLightbox() {
        document.getElementById('lightbox').style.display = 'none';
    }

    // --- 4. 地圖配置 (ECharts) ---
    // 在全域聲明變量，以便 setLang 可以訪問
    const myChartChina = echarts.init(document.getElementById('china-map'));
    const myChartWorld = echarts.init(document.getElementById('world-map'));
    function syncEchartsFont() {
        const currentFont = getComputedStyle(document.body).fontFamily;
    
        const common = {
            textStyle: { fontFamily: currentFont },          // 全局字體
            title: { textStyle: { fontFamily: currentFont } } // title 再保險一次
        };
    
        if (myChartChina) myChartChina.setOption(common);
        if (myChartWorld) myChartWorld.setOption(common);
    }

    function updateChartTitles(chinaTitle, worldTitle) {
        if(myChartChina) myChartChina.setOption({ title: { text: chinaTitle } });
        if(myChartWorld) myChartWorld.setOption({ title: { text: worldTitle } });
    }
// 你原来的 visited 列表（保持不变即可）
const visited = [
  '上海市','西安市','南京市','苏州市','武汉市','锦州市','秦皇岛市','葫芦岛市',
  '赤峰市','承德市','银川市','开封市','西宁市','绍兴市','榆林市','延安市',
  '海西蒙古族藏族自治州','海南藏族自治州','海北藏族自治州','七台河市','牡丹江市','哈尔滨市',
  '无锡市','杭州市','扬州市','景德镇市','九江市','洛阳市','海东市','咸阳市'
];

const MUNICIPALITIES = new Set(['北京市', '上海市', '天津市', '重庆市']);

fetch('assets/maps/china_city_full.json')
  .then(r => {
    if (!r.ok) throw new Error(`China geojson HTTP ${r.status}`);
    return r.json();
  })
  .then(geoJson => {
    const cityFeatures = [];
    const districtByParent = new Map();

    for (const f of geoJson.features) {
      const p = f.properties || {};
      const lvl = p.level;
    if (lvl === 'city') {
      cityFeatures.push(f);
    } else if (lvl === 'province' && (p.name === '台湾省' || p.name === '臺灣省')) {
      cityFeatures.push(f); // 直接塞進同一个 mergedFeatures 即可
    } else if (lvl === 'district' && p.parent && p.parent.adcode) {
        const key = String(p.parent.adcode);
        if (!districtByParent.has(key)) districtByParent.set(key, []);
        districtByParent.get(key).push(f);
      }
    }

    const featureNamesCity = new Set(
      cityFeatures.map(f => f.properties?.name).filter(Boolean)
    );

    const visitedExpanded = new Set();

    for (const name of visited) {
      if (!MUNICIPALITIES.has(name)) {
        visitedExpanded.add(name);
        continue;
      }

      if (featureNamesCity.has(name)) {
        visitedExpanded.add(name);
        continue;
      }

      const parentAdcode =
        name === '北京市' ? '110000' :
        name === '上海市' ? '310000' :
        name === '天津市' ? '120000' :
        name === '重庆市' ? '500000' : null;

      if (parentAdcode && districtByParent.has(parentAdcode)) {
        for (const df of districtByParent.get(parentAdcode)) {
          visitedExpanded.add(df.properties.name);
        }
      } else {
        visitedExpanded.add(name);
      }
    }

    const mergedFeatures = [...cityFeatures];
    for (const parent of ['110000','310000','120000','500000']) {
      if (districtByParent.has(parent)) {
        mergedFeatures.push(...districtByParent.get(parent));
      }
    }

    echarts.registerMap('china_mixed', {
      type: 'FeatureCollection',
      features: mergedFeatures
    });

    myChartChina.setOption({
      title: {
        text: 'China Footprints',
        left: 'center',
        top: 20,
        textStyle: {
          color: '#2c5282',
          fontFamily: getComputedStyle(document.body).fontFamily
        }
      },
      tooltip: { trigger: 'item' },
      series: [{
        type: 'map',
        map: 'china_mixed',
        roam: true ,
      // 初始视角（你可以微调）
        center: [104.0, 35.0],
        zoom: 1.05,
    
      // 限制缩放
        scaleLimit: { min: 1.0, max: 2.2 },
        label: { show: false },
        itemStyle: { areaColor: '#f3f3f3', borderColor: '#999' },
        emphasis: { itemStyle: { areaColor: '#ddd' } },
        data: Array.from(visitedExpanded).map(n => ({
          name: n,
          itemStyle: { areaColor: '#2c5282' }
        }))
      }]
    });

    // 这里调用一次就够了
    setLang('en');
  })
  .catch(err => {
    console.error('China map load failed:', err);
    document.getElementById('china-map').innerHTML =
      '<div style="padding:16px;color:#999;">China map failed to load.</div>';
  });


    fetch('https://raw.githubusercontent.com/apache/echarts-examples/gh-pages/public/data/asset/geo/world.json')
      .then(r => r.json())
      .then(geoJson => {
        echarts.registerMap('world', geoJson);
    
        myChartWorld.setOption({
          title: {
            text: 'World Footprints',
            left: 'center',
            top: 20,
            textStyle: {
              color: '#2c5282',
              fontFamily: getComputedStyle(document.body).fontFamily
            }
          },
          tooltip: { trigger: 'item' },
          geo: {
            map: 'world',
            roam: true,
            label: { show: false },
            itemStyle: { areaColor: '#f3f3f3', borderColor: '#999' },
            emphasis: { itemStyle: { areaColor: '#ddd' } }
          },
          series: [{
            type: 'effectScatter',
            coordinateSystem: 'geo',
            rippleEffect: { brushType: 'stroke' },
            label: { show: true, position: 'right', formatter: '{b}' },
            symbolSize: 5,
            itemStyle: { color: '#2c5282' },
            data: [
              { name: 'Shanghai', value: [121.4737, 31.2304] },
              { name: 'New York', value: [-74.006, 40.7128] }
            ]
          }]
        });
    // 限制拖动：把 center 限制在一个经纬度范围内（按需要调小范围）
    const CHINA_CENTER_CLAMP = {
      lonMin: 73, lonMax: 135,
      latMin: 18, latMax: 54
    };
    
    function clamp(v, a, b) { return Math.max(a, Math.min(b, v)); }
    
    myChartChina.off('georoam'); // 防重复绑定
    myChartChina.on('georoam', () => {
      const opt = myChartChina.getOption();
      const s0 = opt.series && opt.series[0];
      if (!s0) return;
    
      const c = (s0.center && s0.center.length === 2) ? s0.center : [104, 35];
    
      const clamped = [
        clamp(c[0], CHINA_CENTER_CLAMP.lonMin, CHINA_CENTER_CLAMP.lonMax),
        clamp(c[1], CHINA_CENTER_CLAMP.latMin, CHINA_CENTER_CLAMP.latMax),
      ];
    
      // 只有超界才回弹，避免抖动
      if (clamped[0] !== c[0] || clamped[1] !== c[1]) {
        myChartChina.setOption({
          series: [{ center: clamped }]
        }, { notMerge: false, lazyUpdate: true });
      }
    });

    
        setLang('en');
      });
</script>

</body>
</html>
